<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="../../../styles/home.css">
    <link rel="stylesheet" href="../../../styles/popup.css">
    <link rel="stylesheet" href="../../../styles/logout.css">
    <title>Home - Sistema de Automatizacion de Obras SISAO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
</head>
<body>
    <p class="notification"></p>

    <!-- CONTENEDOR DE ESCUDOS -->
    <div class="contentEscudos">
        <img src="../../../img/GDCSF.png" class="imgGDC" alt="Logo GDC">

        <div class="contentEscudosSecun">
            <div class="contentHome">
                <div>
                    <img src="../../../img/home.png" class="imgHome" alt="icono de home">
                </div>
                <a href="../../SUPERADMIN/home/home.html">Inicio</a>
            </div>
            <div>
                <div></div>
                <button class="back-button" id="logoutButton">Cerrar Sesion</button>
            </div>
        </div>

        <img src="../../../img/GOBIERNO.png" class="imgGOB" alt="Logo de Gobierno">
    </div>

    <!-- CONTENEDOR DEL NOMBRE DEL SISTEMA -->
    <div class="contentTitulo">
        <div>
            <svg
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            >
            <path d="M3 4a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-12z" />
            <path d="M3 13h18" />
            <path d="M8 21h8" />
            <path d="M10 17l-.5 4" />
            <path d="M14 17l.5 4" />
            </svg>

        </div>
        <h1>Sistema de Automatizacion de Obras SISAO</h1>
    </div>

    <!-- CONTENEDOR DEL NAV -->
    <div class="contentNav">
        <div>
            <a href="#">OTC</a>
            <a href="#">Dependencias</a>
            <a href="#">Mapas</a>
            <a href="#">PDF's</a>
        </div>
    </div>

    <!-- CONTENEDOR DE LA ESTADISTICA -->
    <div class="contentEstadistica">
        <!-- CONTENEDOR DEL TEXTO -->
        <div class="contentEstText">
            <h1>     CASOS     </h1>
            <div class="contentEstTextPrincipal">
                <div class="contentEstTextPrimario">
                    <div>
                        <a class="linkCasos" href="../../SUPERADMIN/casos/casos.html">CARGADOS</a>
                        <p class="linkCasosP" id="totalCasosCargados"></p>
                    </div>
                    <div>
                        <a>SUPERVISADOS</a>
                        <p id="casosSupervisar"></p>
                    </div>
                    <div>
                        <a>EN DESARROLLO</a>
                        <p id="casosEnDesarrollo"></p>
                    </div>
                    <div>
                        <a>ENTREGADOS</a>
                        <p id="casosFinalizados"></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Botón para abrir el popup de "SUBIR CASO" -->
        <button class="agg-button" onclick="openPopup()">SUBIR CASO</button>

        <!-- CONTENEDOR DE LAS GRAFICAS -->
        <div class="contentEstGrafic" id="graficos">
            <!-- CONTENEDOR DE LAS GRAFICAS DE TORTA -->
            <div style="width: 48%; height: 100%;">
                <canvas id="pieChart"></canvas>
            </div>
            <!-- CONTENEDOR DE LAS GRAFICAS DE BARRA -->
            <div style="width: 48%; height: 100%;">
                <canvas id="barChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Popup para agregar caso (formulario original) -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close" onclick="closePopup()">&times;</span>
            <h2>Agregar Caso</h2>
            <p class="notification"></p>
            <!-- Asegúrate de que tu formulario tenga id="caseForm" y el enctype correcto -->
            <form class="divForm" id="caseForm">
                <div class="divFormA">
                    <div>
                        <label for="tipo_obra">Tipo de Obra</label>
                        <select name="tipo_obra" id="tipo_obra" required>
                            <option value="">Selecciona un tipo de obra</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="parroquia">Parroquia</label>
                        <select name="parroquia" id="parroquia" required>
                            <option value="">Selecciona una Parroquia</option>
                        </select>
                    </div>

                    <div>
                        <label for="circuito">Circuito</label>
                        <select name="circuito" id="circuito" disabled required>
                            <option value="">Circuito asignado automáticamente</option>
                        </select>
                    </div>

                    <div>
                        <label for="eje">Eje</label>
                        <input type="text" id="eje" name="eje" placeholder="Eje" required>
                    </div>

                    <div>
                        <label for="comuna">Comúna</label>
                        <input type="text" id="comuna" name="comuna" placeholder="Nombre de la Comúna" required>
                    </div>

                    <div>
                        <label for="codigoComuna">Código de Comúna</label>
                        <input type="text" id="codigoComuna" name="codigoComuna" placeholder="Código de Comúna" required>
                    </div>
                </div>
                <div class="divFormB">
                    <div>
                        <label for="nameJC">Jefe de Comunidad</label>
                        <input type="text" id="nameJC" name="nameJC" placeholder="Nombre y Apellido" required>
                    </div>
                    
                    <div>
                        <label for="nameJU">Jefe de UBCH</label>
                        <input type="text" id="nameJU" name="nameJU" placeholder="Nombre y Apellido" required>
                    </div>

                    <div>
                        <label for="enlaceComunal">Enlace Comunal</label>
                        <input type="text" id="enlaceComunal" name="enlaceComunal" placeholder="Datos del Enlace Comunal" required>
                    </div>

                    <div>
                        <label for="caseDescription">Descripción del Caso</label>
                        <textarea id="caseDescription" name="caseDescription" placeholder="Escribe los detalles de esta nueva obra" required></textarea>
                    </div>

                    <div class="fechFile">
                        <div class="divFech">
                            <label for="caseDate">Fecha</label>
                            <input type="date" id="caseDate" name="caseDate" required>
                        </div>

                        <div class="divFile">
                            <label for="archivo">Archivo PDF (máx. 2MB)</label>
                            <input type="file" id="archivo" name="archivo" accept=".pdf" placeholder="Formato PDF" required>
                        </div>
                    </div>
                </div>
                
                <button class="btnPopup" type="button" onclick="confirmAndUploadCase()">CARGAR</button>
            </form>
        </div>
    </div>

    <!-- Popup para cerrar sesion -->
    <div id="logoutConfirmModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('logoutConfirmModal')">&times;</span>
            <h2>¿Estás seguro que quieres cerrar sesión?</h2>
            <p>Al cerrar sesión, tendrás que volver a iniciarla para acceder al contenido.</p>
            <div class="button-group">
                <button class="confirm-btn" id="confirmLogoutBtn">Sí, cerrar sesión</button>
                <button class="cancel-btn" onclick="closeModal('logoutConfirmModal')">No, quedarse</button>
            </div>
        </div>
    </div>

    <!-- Carga de scripts: algunos con type="module", otros sin (como tu lo tenías) -->
    <script type="module" src="../../../scripts/sesion/auth.js"></script>
    <script type="module" src="../../../scripts/sesion/logout.js"></script>
    <script type="module" src="../../../scripts/home/charts_renderer.js"></script>
    <script type="module" src="../../../scripts/home/counter_loader.js"></script>
    <script type="module" src="../../../scripts/home/popupOpenClose.js"></script>
    <script type="module" src="../../../scripts/home/select_populator.js"></script>
    <script type="module" src="../../../scripts/home/form_handler.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('user'));
            const subirCasoButton = document.querySelector('.agg-button'); // Botón "SUBIR CASO"
            
            if (subirCasoButton) { // Asegurarse que el botón existe antes de intentar modificarlo
                if (user && user.role) {
                    // El botón debe ser visible para SUPERADMIN y ADMIN
                    // Ocultar solo si el rol NO ES SUPERADMIN y NO ES ADMIN
                    if (user.role !== 'superadmin' && user.role !== 'admin') {
                        subirCasoButton.style.display = 'none';
                    } else {
                        subirCasoButton.style.display = ''; // Asegurarse que sea visible si es ADMIN o SUPERADMIN
                    }
                } else {
                    // Si no hay información de usuario o rol, ocultar por seguridad
                    subirCasoButton.style.display = 'none';
                    // Opcionalmente, redirigir a login si no hay usuario
                    // console.log('Usuario no encontrado o sin rol, ocultando botón y redirigiendo...');
                    // window.location.href = '../../../login - signup/auth.html'; // Ajustar ruta si es necesario
                }
            }
        });
    </script>
</body>
</html>